引脚接线：

SSD1306(i2c0):
SDA->401(504旁)
SCL ->400

AHT10(i2c1):
SCL->512
SDA->511

ESP8266:

TX->P101

RX->P101

RC522:

MOSI(主出从入):P411(MOSIA)
MISO(主入从出):P410(MISOA)
SCK(串行时钟线):P412(RSPCKA)

RST():P312   0x3c  138
SDA(片选)：P311(SS)   	0x3b



```
总体设计：

初始化命令行：
OLED初始化
AHT10初始化

需求：
AHT10获取温湿度信息后，显示在OLED屏上
RC522获取读卡信号后，进行信号提示OLED
AHT10获取温湿度信息后，数据上云

线程设计
AHT10初始化线程，在中断程序中上传数据至邮箱
RC522初始化线程，在中断程序中进行读卡操作
onenet初始化线程，设置读卡的中断触发事件，同时平均四十分钟更新一次温湿度信息并上传云端
oled初始化线程，设置两个触发事件，分别是当读卡收到反馈后进行一次屏幕刷新；当第一次AHT10数据刷新时更新界面为温湿度显示。

MFRC线程创建，在入口函数中进行读卡操作
邮箱创建后传入句柄，在头文件中extern声明,线程入口函数中自己创建一个char数组
```








## RC522函数分析

---

#### 一、知识扩展：

// M1卡分为16个扇区，每个扇区由四个块（块0、块1、块2、块3）组成
// 将16个扇区的64个块按绝对地址编号为：0~63
// 第0个扇区的块0（即绝对地址0块），用于存放厂商代码，已经固化不可更改
// 每个扇区的块0、块1、块2为数据块，可用于存放数据
// 每个扇区的块3为控制块（绝对地址为:块3、块7、块11.....）包括密码A，存取控制、密码B等

![在这里插入图片描述](https://img-blog.csdnimg.cn/20210112142142412.png)









#define MFRC522_SS_PIN 0x205

/* Notice: PH8 --> 120 */

#define MFRC522_RST_PIN 0x206

#define BSP_USING_I2C
#define BSP_USING_I2C0
#define BSP_I2C0_SCL_PIN 0x400
#define BSP_I2C0_SDA_PIN 0x401



![image-20220727181744196](https://raw.githubusercontent.com/kurisaW/picbed/main/img/202207271817558.png)



*连线说明：
1--SDA  <----->P505
2--SCK  <----->P504
3--MOSI <----->P503
4--MISO <----->P502
5--悬空
6--GND <----->GND
7--RST <----->P501
8--VCC <----->VCC

#### 二、流程

**寻卡->防止卡片冲撞->选卡->休眠->发送0x40（7bit）->发送0x43->发送0xa0等4字节->发送0x00等18字节**



#### 三、项目提交要求

github提交代码工程：说明文档（应用场景、整体软硬件架构图、硬件情况、软件说明、演示视频）

---

